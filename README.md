# Chatterbot

> Advanced Discord AI bot powered by Google Gemini.

[Browse the API Docs »](./docs/api/index.html)

A production-ready Discord bot built with TypeScript and Discord.js v14, featuring unified AI conversation via a single /chat command, optional agentic tools, and clean modular architecture.

### Highlights
- Unified /chat command with multimodal Google Gemini integration
- Opt-in conversational mode after first /chat
- Optional agentic features: knowledge base, escalation, stats
- Prisma (SQLite by default), structured logging, health endpoint
- Minimal configuration; works without optional external APIs

---

### Quick Start
```bash
# 1) Install dependencies
npm install

# 2) Configure environment
cp env.example .env
# Edit .env and set: DISCORD_TOKEN, DISCORD_CLIENT_ID, GEMINI_API_KEY

# 3) Initialize database (SQLite by default)
npx prisma migrate dev --name init

# 4) Run in dev
npm run dev
```

---

### Commands
- /chat prompt [attachment]
  - Primary command. After first use, the bot will respond to your normal messages (opt-in).

- Agentic commands (enabled when ENABLE_AGENTIC_INTELLIGENCE=true):
  - /learn question answer [tags]
  - /knowledge query
  - /escalate query [reason]
  - /agentic-stats

---

### Configuration
Required
```env
DISCORD_TOKEN=your_discord_bot_token
DISCORD_CLIENT_ID=your_discord_app_id
GEMINI_API_KEY=your_google_gemini_key
```

Optional
```env
# Feature flags
ENABLE_AGENTIC_INTELLIGENCE=true
ENABLE_ENHANCED_INTELLIGENCE=false

# Analytics dashboard
ENABLE_ANALYTICS_DASHBOARD=false
ANALYTICS_DASHBOARD_PORT=3001

# Logging
LOG_LEVEL=info  # error|warn|info|debug
NODE_ENV=development
```

Enhanced intelligence (optional MCP-backed features)
```env
ENABLE_ENHANCED_INTELLIGENCE=true

# External API keys (optional; enable related tools if present)
BRAVE_API_KEY=your_brave_api_key      # Web search
FIRECRAWL_API_KEY=your_firecrawl_key  # Content extraction

# MCP integration
ENABLE_MCP_INTEGRATION=true
```

Notes
- Using /chat once opts you in; subsequent non-command messages get intelligent replies.
- The bot works without BRAVE_API_KEY/FIRECRAWL_API_KEY; those only enable advanced tools.

---

### Project Structure (abridged)
```
src/
├─ index.ts                     # Bot entry point
├─ services/
│  ├─ core-intelligence.service.ts   # /chat pipeline
│  ├─ gemini.service.ts              # Google Gemini integration
│  ├─ analytics-dashboard.ts         # Optional metrics API
│  ├─ ...
├─ commands/
│  └─ agentic-commands.ts            # /learn, /knowledge, /escalate, /agentic-stats
├─ prisma/
│  └─ schema.prisma                  # SQLite by default
```

---

### Documentation
- API docs: `docs/api/` (generated by TypeDoc)
- Legacy and planning docs have been moved to `archive/docs/`

---

### Database
- If you build or run locally outside Docker, generate Prisma client once:
  - `npx prisma generate`
- Default DB is SQLite. Set `DATABASE_URL` to switch.

---

### Observability
- Health: GET `/health` on `HEALTH_CHECK_PORT` (default 3000)
- Metrics: GET `/metrics` (Prometheus exposition format)
- Analytics dashboard (optional): enable with `ENABLE_ANALYTICS_DASHBOARD=true` and visit `http://localhost:${ANALYTICS_DASHBOARD_PORT||3001}`

---

### Docker
```bash
# Build
docker build -t chatterbot .

# Run (example)
docker run --rm -it \
  -e DISCORD_TOKEN=... \
  -e DISCORD_CLIENT_ID=... \
  -e GEMINI_API_KEY=... \
  chatterbot
```

---

### Development
- Lint: `npm run lint`
- Typecheck: `npm run typecheck`
- Test: `npm test`
- Docs: `npm run docs`

---

### License
MIT © 2025
